<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini CTF – Puzzle Gauntlet</title>
  <style>
    /* ====== Base theme ====== */
    :root{
      --bg:#0b1020; --panel:#121933; --ink:#e8ecff; --muted:#a7b0d9; --accent:#61dbfb; --good:#22c55e; --bad:#ef4444; --border:#243056;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial,Apple Color Emoji,Segoe UI Emoji;
      color:var(--ink); background:radial-gradient(1200px 800px at 10% 10%,#18224a 0%,#0b1020 50%,#070a16 100%);
    }
    header{position:sticky; top:0; backdrop-filter:saturate(140%) blur(8px);
      background:linear-gradient(180deg, rgba(9,13,29,.8), rgba(9,13,29,0));
      border-bottom:1px solid #101631; z-index:50
    }
    .wrap{max-width:1000px; margin:0 auto; padding:20px}
    .hero{display:grid; grid-template-columns:1.2fr .8fr; gap:24px; align-items:center}
    .card{background:linear-gradient(180deg,#16214a,#101735); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card h2{margin:0 0 6px; font-size:28px}
    .card h3{margin:0 0 8px; font-size:22px}
    .card p{color:var(--muted)}
    .pad{padding:20px}
    .progress{display:flex; gap:10px; align-items:center}
    .pill{padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#0e1530; color:var(--muted); font-weight:600}
    .pill.done{color:#0f172a; background:linear-gradient(180deg,#a7f3d0,#34d399); border-color:#34d399}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
    .btn{background:linear-gradient(180deg,#61dbfb,#21b1e8); border:none; color:#021624; font-weight:800; padding:10px 14px; border-radius:12px; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .muted{color:var(--muted)}

    section{margin:26px 0}
    section.locked .veil{position:absolute; inset:0; border-radius:var(--radius); background:rgba(10,14,26,.6); display:grid; place-items:center}
    section .title{display:flex; align-items:center; gap:10px}
    section .num{width:28px; height:28px; display:grid; place-items:center; background:#0e1530; border:1px solid var(--border); border-radius:8px; color:var(--muted); font-weight:700}

    /* Word path (click letters in order) */
    .ws-grid{display:grid; grid-template-columns:repeat(10,32px); gap:6px; padding:10px; background:#0e1530; border:1px solid var(--border); border-radius:12px}
    .ws-cell{width:32px; height:32px; display:grid; place-items:center; border-radius:6px; user-select:none; font-weight:800; letter-spacing:.5px; background:#11193b; border:1px solid #27335d; cursor:pointer}
    .ws-cell.sel{outline:2px solid var(--accent); background:#0d2544}
    .ws-cell.correct{background:#153d2d; border-color:#1b6a4a}

    /* Tic tac toe */
    .ttt{display:grid; grid-template-columns:repeat(3,80px); gap:8px; padding:8px; background:#0e1530; border:1px solid var(--border); border-radius:12px; width:max-content}
    .ttt button{height:80px; font-size:28px; font-weight:800; border-radius:10px; border:1px solid #27335d; background:#11193b; color:var(--ink); cursor:pointer}
    .ttt button:disabled{cursor:default}
    .ttt .win{background:#153d2d; border-color:#1b6a4a}

    /* Spot the difference (SVG) */
    .dif-wrap{display:flex; gap:16px; flex-wrap:wrap}
    .dif{background:#0e1530; border:1px solid var(--border); border-radius:12px; padding:10px}
    .dif svg{display:block}
    .dif .hit{position:absolute}
    .badge{background:#0e1530; border:1px solid var(--border); padding:6px 10px; border-radius:999px; font-weight:700}

    /* Word Jumble */
    .jumble{display:grid; gap:10px; max-width:560px}
    .row{display:grid; grid-template-columns:1fr 140px; gap:8px; align-items:center}
    .row input{height:40px; border-radius:10px; border:1px solid #27335d; background:#11193b; color:var(--ink); padding:0 10px; font-weight:700}
    .ok{color:var(--good); font-weight:800}
    .no{color:var(--bad); font-weight:800}

    /* Final flag */
    .flag{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#061221; padding:14px; border:1px dashed #1a2b51; border-radius:12px; color:#b9ffce}
    .center{display:flex; gap:10px; align-items:center}

    @media (max-width: 820px){
      .hero{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="hero">
        <div class="card pad">
          <h2>Mini CTF: Puzzle Gauntlet</h2>
          <p>Clear each challenge to earn a 4‑character code. Combine all codes to reveal the final flag. Puzzles unlock in order. Good luck!</p>
          <div class="progress" id="progress">
            <span class="pill" id="p1">Puzzle 1</span>
            <span class="pill" id="p2">Puzzle 2</span>
            <span class="pill" id="p3">Puzzle 3</span>
            <span class="pill" id="p4">Puzzle 4</span>
          </div>
        </div>
        <div class="card pad">
          <h3>How to deploy</h3>
          <ol class="muted">
            <li>Download this file as <b>index.html</b>.</li>
            <li>Drop it on Netlify/Cloudflare Pages/GitHub Pages.</li>
            <li>No build step. No dependencies. Have fun.</li>
          </ol>
          <button class="btn" onclick="scrollToPuzzles()">Jump to puzzles ↓</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- ===== Puzzle 1: Word Path (click letters in order to spell CAMERA) ===== -->
    <section id="s1" class="card pad" aria-label="Puzzle 1">
      <div class="title"><span class="num">1</span><h3>Word Path: spell <em>CAMERA</em></h3></div>
      <p class="muted">Click letters <b>in order</b> to trace the word. Only adjacent steps (horiz/vert/diag) count.</p>
      <div class="ws-grid" id="ws"></div>
      <div id="w1status" class="muted" style="margin-top:8px"></div>
    </section>

    <!-- ===== Puzzle 2: Tic‑Tac‑Toe (beat the bot once) ===== -->
    <section id="s2" class="card pad locked" aria-label="Puzzle 2" style="position:relative;">
      <div class="veil"><span class="badge">Locked – finish Puzzle 1</span></div>
      <div class="title"><span class="num">2</span><h3>Tic‑Tac‑Toe: Beat the bot</h3></div>
      <p class="muted">You are <b>X</b>. Win one game to earn the code. The bot plays reasonably but not perfectly.</p>
      <div class="ttt" id="ttt"></div>
      <div class="center" style="margin-top:8px; gap:12px">
        <button class="btn" id="tttReset">Reset</button>
        <span id="tttMsg" class="muted"></span>
      </div>
    </section>

    <!-- ===== Puzzle 3: Spot the Differences (find 5) ===== -->
    <section id="s3" class="card pad locked" aria-label="Puzzle 3" style="position:relative;">
      <div class="veil"><span class="badge">Locked – finish Puzzle 2</span></div>
      <div class="title"><span class="num">3</span><h3>Spot the Differences: Find 5</h3></div>
      <p class="muted">Two scenes, five small differences on the right image. Tap the differences.</p>
      <div class="dif-wrap">
        <!-- Left (reference) -->
        <div class="dif"><svg id="svgl" width="260" height="180" viewBox="0 0 260 180" xmlns="http://www.w3.org/2000/svg" aria-label="reference">
          <rect x="0" y="0" width="260" height="180" rx="14" fill="#0c1330" stroke="#27335d"/>
          <circle cx="60" cy="60" r="28" fill="#61dbfb"/>
          <rect x="120" y="40" width="90" height="40" rx="8" fill="#34d399"/>
          <polygon points="40,140 80,120 120,140 80,160" fill="#a78bfa"/>
          <rect x="170" y="115" width="40" height="40" rx="6" fill="#f59e0b"/>
          <text x="18" y="25" fill="#a7b0d9" font-size="14" font-family="monospace">SCENE A</text>
        </svg></div>
        <!-- Right (with differences) -->
        <div class="dif" style="position:relative"><svg id="svgr" width="260" height="180" viewBox="0 0 260 180" xmlns="http://www.w3.org/2000/svg" aria-label="differences">
          <rect x="0" y="0" width="260" height="180" rx="14" fill="#0c1330" stroke="#27335d"/>
          <circle cx="60" cy="60" r="24" fill="#61dbfb"/> <!-- r change -->
          <rect x="120" y="40" width="90" height="40" rx="8" fill="#34d399"/>
          <polygon points="40,140 80,120 120,140 80,160" fill="#a78bfa"/>
          <rect x="172" y="115" width="40" height="36" rx="6" fill="#f59e0b"/> <!-- width/pos change -->
          <text x="18" y="25" fill="#a7b0d9" font-size="16" font-family="monospace">SCENE A</text> <!-- font-size change -->
          <rect x="10" y="10" width="20" height="8" rx="2" fill="#ef4444"/> <!-- extra bar -->
          <circle cx="120" cy="150" r="6" fill="#22c55e"/> <!-- extra dot -->
        </svg>
        <!-- Click targets overlay -->
        <div id="difTargets"></div>
        </div>
      </div>
      <p class="muted" id="difMsg" style="margin-top:8px"></p>
    </section>

    <!-- ===== Puzzle 4: Word Jumble (solve 4 words) ===== -->
    <section id="s4" class="card pad locked" aria-label="Puzzle 4" style="position:relative;">
      <div class="veil"><span class="badge">Locked – finish Puzzle 3</span></div>
      <div class="title"><span class="num">4</span><h3>Word Jumble: Unscramble the set</h3></div>
      <p class="muted">Unscramble each to everyday words related to this site. All lowercase.</p>
      <div class="jumble" id="jumble"></div>
      <p id="jumbleMsg" class="muted"></p>
    </section>

    <!-- ===== Final Flag ===== -->
    <section id="final" class="card pad locked" style="position:relative;">
      <div class="veil"><span class="badge">Locked – finish all puzzles</span></div>
      <div class="title"><span class="num">★</span><h3>Capture the Flag</h3></div>
      <p class="muted">Enter the four codes you earned to reveal the flag:</p>
      <div class="row" style="max-width:560px">
        <input id="c1" placeholder="Code 1" maxlength="4" aria-label="code 1"/>
        <input id="c2" placeholder="Code 2" maxlength="4" aria-label="code 2"/>
      </div>
      <div class="row" style="max-width:560px; margin-top:8px">
        <input id="c3" placeholder="Code 3" maxlength="4" aria-label="code 3"/>
        <input id="c4" placeholder="Code 4" maxlength="4" aria-label="code 4"/>
      </div>
      <div class="center" style="margin-top:12px">
        <button class="btn" id="revealBtn">Reveal Flag</button>
        <span id="flagMsg" class="muted"></span>
      </div>
      <pre class="flag" id="flagBox" style="margin-top:14px; display:none">FLAG{PUZZLES-ARE-RAD}</pre>
    </section>

    <section class="muted" style="margin:30px 0 60px">
      <details>
        <summary>Admin quick-edit (codes & answers)</summary>
        <p>Edit the <code>CTF</code> config in the script for different words/codes, or replace the SVG in Puzzle 3 with your own.</p>
      </details>
    </section>

  </main>

  <script>
    // ===== Config you can tweak =====
    const CTF = {
      wordPath: { target: "CAMERA", // what to click in order
        grid: [
          "K Z C A M P L E T U",
          "Q R T M E A R A O I",
          "B C A M E R A S D F",
          "H J K L Q W E R T Y",
          "U I O P A S D F G H",
          "Z X C V B N M Q W E",
          "A A A A A A A A A A",
          "P U Z Z L E S R O C",
          "C A M E R A X Y Z Z",
          "F U N G A M E S Q W"],
        code: "A1C9" },
      ttt: { winCode: "X0X0" },
      differences: {
        // click targets (x,y,r) in SVG right image coordinate space
        targets: [ {x:60,y:60,r:14}, {x:192,y:133,r:14}, {x:30,y:14,r:12}, {x:120,y:150,r:10}, {x:62,y:60,r:22, type:'radius'} ],
        code: "D1F5" },
      jumble: {
        set: [
          {scrambled:"tseelm", answer:"stleem"}, // will fix below to be sensible
        ]
      }
    };
    // Fix jumble set to be sensible words
    CTF.jumble.set = [
      {scrambled:"sitet", answer:"sites"},
      {scrambled:"dalregin", answer:"redialgn"}, // nope, let's pick better
    ];
  </script>
  <script>
    // Rebuild clean jumbles (keeping it tidy)
    const JUMBLES = [
      { scrambled:"steli", answer:"sitel" }, // still odd. We'll define proper ones below.
    ];
  </script>
  <script>
    // ===== Okay, define final clean config (ignore above scratch) =====
    const CFG = {
      wordPath: {
        target: "CAMERA",
        grid: [
          "K Z C A M P L E T U",
          "Q R T M E A R A O I",
          "B C A M E R A S D F",
          "H J K L Q W E R T Y",
          "U I O P A S D F G H",
          "Z X C V B N M Q W E",
          "A A A A A A A A A A",
          "P U Z Z L E S R O C",
          "C A M E R A X Y Z Z",
          "F U N G A M E S Q W"
        ],
        code: "A1C9"
      },
      ttt: { winCode: "X0X0" },
      differences: {
        targets: [
          {x:60, y:60, r:16},      // circle radius change
          {x:192, y:133, r:18},    // orange rect shift/size
          {x:30, y:14, r:12},      // red bar
          {x:120, y:150, r:12},    // green dot
          {x:40, y:140, r:20}      // subtle polygon area (soft check)
        ],
        code: "D1F5"
      },
      jumble: {
        words: [
          { scrambled: "tseilm", answer: "smile" },
          { scrambled: "zpuzle", answer: "puzzle" },
          { scrambled: "gmae", answer: "game" },
          { scrambled: "flga", answer: "flag" }
        ],
        code: "J9B2"
      },
      finalFlag: "FLAG{PUZZLES-ARE-RAD}"
    };

    // ===== Utilities =====
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const unlock = id => { const s = $(id); s.classList.remove('locked'); s.querySelector('.veil')?.remove(); };
    const markDone = n => { const p = $('#p'+n); p.classList.add('done'); p.textContent = 'Puzzle '+n+' ✓'; };

    function scrollToPuzzles(){ document.getElementById('s1').scrollIntoView({behavior:'smooth'}); }

    // ===== Puzzle 1: Word Path =====
    (function initWordPath(){
      const gridEl = document.getElementById('ws');
      const letters = CFG.wordPath.grid.map(row => row.split(' '));
      const target = CFG.wordPath.target;
      const state = { sel: [], solved:false };

      // build grid
      letters.forEach((row,y)=>row.forEach((ch,x)=>{
        const b = document.createElement('div');
        b.className = 'ws-cell';
        b.textContent = ch;
        b.dataset.x = x; b.dataset.y = y;
        b.addEventListener('click',()=>{
          if(state.solved) return;
          const cx = +b.dataset.x, cy = +b.dataset.y;
          const nextIndex = state.sel.length;
          if(ch !== target[nextIndex]){ // wrong letter -> reset selection
            state.sel.forEach(c=>c.el.classList.remove('sel'));
            state.sel = [];
            $('#w1status').textContent = 'Wrong letter. Start again from C–A–M–E–R–A.';
            return;
          }
          // If not first, ensure adjacency
          if(nextIndex>0){
            const prev = state.sel[state.sel.length-1];
            const dx = Math.abs(prev.x - cx), dy = Math.abs(prev.y - cy);
            if(dx>1 || dy>1){ $('#w1status').textContent='Not adjacent – try again.'; return; }
          }
          b.classList.add('sel');
          state.sel.push({x:cx,y:cy,el:b});
          $('#w1status').textContent = `Progress: ${state.sel.length}/${target.length}`;
          if(state.sel.length===target.length){
            state.solved = true;
            state.sel.forEach(c=>c.el.classList.add('correct'));
            $('#w1status').innerHTML = `Solved! Your code: <b>${CFG.wordPath.code}</b>`;
            markDone(1); unlock('#s2');
          }
        });
        gridEl.appendChild(b);
      }));
    })();

    // ===== Puzzle 2: Tic Tac Toe =====
    (function initTTT(){
      const boardEl = document.getElementById('ttt');
      const btnReset = document.getElementById('tttReset');
      const msg = document.getElementById('tttMsg');
      let board, over;

      function newGame(){
        board = Array(9).fill(''); over=false; msg.textContent='You are X. Your move.';
        boardEl.innerHTML='';
        for(let i=0;i<9;i++){
          const b=document.createElement('button');
          b.addEventListener('click',()=>move(i,b));
          boardEl.appendChild(b);
        }
      }
      function lines(){return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]]}
      function winner(){ for(const [a,b,c] of lines()){ if(board[a]&&board[a]===board[b]&&board[a]===board[c]) return {p:board[a], line:[a,b,c]}; } return null; }
      function empty(){ return board.map((v,i)=>v?null:i).filter(v=>v!==null); }
      function bot(){ // simple: win > block > center > corner > random
        const e = empty(); if(!e.length) return;
        // Try to win or block
        for(const me of ['O','X']){
          for(const i of e){ board[i]=me; if(winner()?.p===me){ board[i]=''; return i; } board[i]=''; }
        }
        if(board[4]==='') return 4;
        const corners=[0,2,6,8].filter(i=>board[i]===''); if(corners.length) return corners[Math.floor(Math.random()*corners.length)];
        return e[Math.floor(Math.random()*e.length)];
      }
      function move(i,btn){ if(over||board[i]) return; board[i]='X'; btn.textContent='X';
        const w=winner(); if(w){ end('You win!', w.line); msg.innerHTML = `Win! Your code: <b>${CFG.ttt.winCode}</b>`; markDone(2); unlock('#s3'); return; }
        if(!empty().length){ end('Tie.', []); return; }
        // bot
        const j=bot(); if(j==null) return; board[j]='O'; boardEl.children[j].textContent='O';
        const w2=winner(); if(w2){ end('Bot wins!', w2.line); return; }
        if(!empty().length){ end('Tie.', []); }
      }
      function end(text, line){ over=true; msg.textContent=text; line.forEach(k=>boardEl.children[k].classList.add('win')); [...boardEl.children].forEach(b=>b.disabled=true); }

      btnReset.addEventListener('click', newGame);
      newGame();
    })();

    // ===== Puzzle 3: Spot the Differences =====
    (function initDif(){
      const wrap = document.getElementById('difTargets');
      const msg = document.getElementById('difMsg');
      const found = new Set();
      // create invisible clickable zones
      CFG.differences.targets.forEach((t,idx)=>{
        const z=document.createElement('div');
        z.style.position='absolute';
        z.style.left=(t.x - t.r)+'px';
        z.style.top=(t.y - t.r)+'px';
        z.style.width=(t.r*2)+'px';
        z.style.height=(t.r*2)+'px';
        z.style.borderRadius='50%';
        z.style.cursor='pointer';
        z.title='Touch';
        z.addEventListener('click',()=>{
          if(found.has(idx)) return; found.add(idx);
          z.style.outline='2px solid #34d399'; z.style.boxShadow='0 0 0 6px rgba(52,211,153,.25)';
          msg.textContent = `Found ${found.size}/5`;
          if(found.size===5){ msg.innerHTML = `All found! Your code: <b>${CFG.differences.code}</b>`; markDone(3); unlock('#s4'); }
        });
        wrap.appendChild(z);
      });
      msg.textContent='Found 0/5';
    })();

    // ===== Puzzle 4: Word Jumble =====
    (function initJumble(){
      const root = document.getElementById('jumble');
      const msg = document.getElementById('jumbleMsg');
      CFG.jumble.words.forEach((w,i)=>{
        const row=document.createElement('div'); row.className='row';
        const label=document.createElement('div'); label.className='muted'; label.textContent = `${i+1}. ${w.scrambled}`;
        const input=document.createElement('input'); input.placeholder='answer';
        const status=document.createElement('div'); status.className='muted'; status.textContent='';
        input.addEventListener('input',()=>{
          const ok = input.value.trim().toLowerCase()===w.answer;
          status.textContent = ok ? '✓' : '';
          status.className = ok? 'ok' : 'muted';
          checkAll();
        });
        const wrap=document.createElement('div'); wrap.style.display='grid'; wrap.style.gridTemplateColumns='1fr 40px'; wrap.style.gap='8px';
        wrap.appendChild(input); wrap.appendChild(status);
        row.innerHTML=''; row.appendChild(label); row.appendChild(wrap);
        root.appendChild(row);
      });
      function checkAll(){
        const inputs = root.querySelectorAll('input');
        const answers = CFG.jumble.words.map(w=>w.answer);
        const all = Array.from(inputs).every((inp,idx)=>inp.value.trim().toLowerCase()===answers[idx]);
        if(all){ msg.innerHTML = `Nice! Your code: <b>${CFG.jumble.code}</b>`; markDone(4); unlock('#final'); }
      }
    })();

    // ===== Final Reveal =====
    (function initFinal(){
      const btn = document.getElementById('revealBtn');
      const msg = document.getElementById('flagMsg');
      const flagBox = document.getElementById('flagBox');
      btn.addEventListener('click',()=>{
        const got = [$('#c1').value, $('#c2').value, $('#c3').value, $('#c4').value].map(s=>s.trim().toUpperCase());
        const expect = [CFG.wordPath.code, CFG.ttt.winCode, CFG.differences.code, CFG.jumble.code];
        if(got.join('|')===expect.join('|')){
          msg.textContent = 'Success!';
          flagBox.textContent = CFG.finalFlag; flagBox.style.display='block';
        } else {
          msg.textContent = 'Codes incorrect. Keep hunting!';
          flagBox.style.display='none';
        }
      });
    })();

    // Mark initial progress UI
    document.getElementById('p1').classList.add('pill');
  </script>
</body>
</html>
